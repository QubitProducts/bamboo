# circle.yml
machine:
  services:
    - docker
  ruby:
    version: 2.1.1
  environment:
    FOO: up
    BAMBOO_PROJECT_DIR: /home/ubuntu/bamboo
    WORKSPACE: /home/ubuntu/bamboo

dependencies:
  pre:
    - gem install fpm --pre
    - go get github.com/tools/godep
    - go get bitbucket.org/tebeka/go2xunit
    - go get -t github.com/smartystreets/goconvey
  post:
    - bash $WORKSPACE/builder/build.sh

test:
  pre:
  override:
    - mkdir -p  $WORKSPACE/test_output
    - go test -v github.com/QubitProducts/bamboo/... | go2xunit > $WORKSPACE/test_output/tests.xml

deployment:
  hub:
    branch: ab_rebase_to_qubit
    commands:
      - docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS
      - docker push placeable/bamboo:ab_rebase
  production:
    branch: master
    commands:
      - sudo pip install awscli
      - aws s3 sync builder/ s3://placeable-artifacts/qubit-bamboo/ --exclude "*"  --include "*.deb"
